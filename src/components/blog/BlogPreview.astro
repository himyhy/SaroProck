---
import { type CollectionEntry, getCollection } from "astro:content";

type BlogEntry = CollectionEntry<"blog">;

interface Post {
  slug: string;
  title: string;
  description: string;
  pubDate: string;
}

const posts = await getCollection(
  "blog",
  (entry: BlogEntry) => entry.data.draft !== true,
);

const blogPosts: Post[] = posts
  .map((post: BlogEntry) => ({
    slug: post.slug,
    title: post.data.title,
    description: post.data.description,
    pubDate: post.data.pubDate.toISOString(),
  }))
  .sort(
    (a: Post, b: Post) =>
      new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime(),
  )
  .slice(0, 3);

const formatDate = (dateStr: string) => {
  const date = new Date(dateStr);
  return date.toLocaleDateString("zh-CN", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
};
---

<div class="my-12">
  <div class="flex items-center justify-between mb-8">
    <div>
      <h2 class="text-3xl font-bold mb-2">ğŸ“š æœ€æ–°åšæ–‡</h2>
      <p class="text-sm text-base-content/60">æ·±åº¦æ€è€ƒä¸æŠ€æœ¯åˆ†äº«</p>
    </div>
    <a href="/blog" class="btn btn-primary btn-outline gap-2">
      æŸ¥çœ‹å…¨éƒ¨
      <i class="ri-arrow-right-line" />
    </a>
  </div>

  <div class="space-y-4">
    {
      blogPosts.map((post, idx) => (
        <a
          href={`/blog/${post.slug}`}
          class="group block p-6 rounded-xl bg-base-100 border border-base-200 hover:border-primary hover:shadow-lg transition-all duration-300"
        >
          <div class="flex items-start justify-between gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="text-sm font-semibold text-primary/60">
                  {String(idx + 1).padStart(2, "0")}
                </span>
                <h3 class="text-lg font-bold group-hover:text-primary transition-colors line-clamp-2">
                  {post.title}
                </h3>
              </div>
              <p class="text-sm text-base-content/70 line-clamp-2 mb-3">
                {post.description}
              </p>
              <time class="text-xs text-base-content/50">
                {formatDate(post.pubDate)}
              </time>
            </div>
            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-all">
              <i class="ri-arrow-right-line text-sm" />
            </div>
          </div>
        </a>
      ))
    }
  </div>
</div>
